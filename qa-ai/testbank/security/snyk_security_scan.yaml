# Snyk Security Scanning Test Case
# Comprehensive vulnerability assessment for ShareConnect

test_case:
  id: "SEC_SNYK_001"
  name: "Snyk Security Vulnerability Scan"
  description: "Automated security scanning using Snyk to detect vulnerabilities in dependencies, containers, and code"
  category: "SECURITY"
  priority: "CRITICAL"
  type: "AUTOMATED"

metadata:
  author: "AI QA System"
  created: "2025-01-18"
  updated: "2025-01-18"
  tags:
    - "security"
    - "vulnerability"
    - "snyk"
    - "dependencies"
    - "containers"
    - "gradle"

prerequisites:
  - "Docker is running and accessible"
  - "SNYK_TOKEN environment variable is set"
  - "Internet connection for Snyk API access"
  - "Project dependencies are properly configured"

test_steps:
  - step_id: "SEC_SNYK_001_01"
    description: "Initialize Snyk scanning environment"
    action: "setup_environment"
    parameters:
      check_docker: true
      check_snyk_token: true
      validate_config: true
    expected_result: "Environment ready for scanning"
    timeout_seconds: 30

  - step_id: "SEC_SNYK_001_02"
    description: "Run dependency vulnerability scan"
    action: "scan_dependencies"
    parameters:
      severity_threshold: "medium"
      detection_depth: 6
      include_dev_dependencies: true
      scan_all_projects: true
    expected_result: "Dependency scan completed without critical errors"
    timeout_seconds: 300

  - step_id: "SEC_SNYK_001_03"
    description: "Run container image vulnerability scan"
    action: "scan_containers"
    parameters:
      dockerfile_path: "Dockerfile"
      severity_threshold: "medium"
      include_base_images: true
    expected_result: "Container scan completed"
    timeout_seconds: 180

  - step_id: "SEC_SNYK_001_04"
    description: "Run Gradle-specific dependency scan"
    action: "scan_gradle"
    parameters:
      gradle_files_pattern: "**/build.gradle*"
      severity_threshold: "medium"
      include_all_configurations: true
    expected_result: "Gradle dependency scan completed"
    timeout_seconds: 240

  - step_id: "SEC_SNYK_001_05"
    description: "Analyze and categorize vulnerabilities"
    action: "analyze_results"
    parameters:
      generate_report: true
      categorize_by_severity: true
      identify_fixable_issues: true
      check_sla_compliance: true
    expected_result: "Vulnerability analysis completed with actionable insights"
    timeout_seconds: 60

  - step_id: "SEC_SNYK_001_06"
    description: "Generate comprehensive security reports"
    action: "generate_reports"
    parameters:
      formats:
        - "html"
        - "json"
        - "sarif"
        - "junit"
      include_recommendations: true
      generate_summary: true
    expected_result: "Security reports generated successfully"
    timeout_seconds: 120

validation_criteria:
  - criterion: "no_critical_vulnerabilities"
    description: "Zero critical severity vulnerabilities found"
    type: "THRESHOLD"
    threshold: 0
    operator: "LESS_THAN_OR_EQUAL"
    severity: "CRITICAL"

  - criterion: "limited_high_vulnerabilities"
    description: "High severity vulnerabilities within acceptable limit"
    type: "THRESHOLD"
    threshold: 5
    operator: "LESS_THAN_OR_EQUAL"
    severity: "HIGH"

  - criterion: "scan_completion"
    description: "All scan types completed successfully"
    type: "BOOLEAN"
    expected_value: true
    severity: "CRITICAL"

  - criterion: "report_generation"
    description: "Security reports generated in all requested formats"
    type: "BOOLEAN"
    expected_value: true
    severity: "MEDIUM"

  - criterion: "fixable_issues_identified"
    description: "Fixable vulnerabilities properly identified"
    type: "BOOLEAN"
    expected_value: true
    severity: "MEDIUM"

test_data:
  mock_vulnerabilities:
    - id: "SNYK-JAVA-ORGSPRINGFRAMEWORK-12345"
      severity: "high"
      package: "org.springframework:spring-core"
      version: "5.2.0"
      fix_available: true
      cve: "CVE-2020-12345"

    - id: "SNYK-JAVA-COMGOOGLEGUAVA-67890"
      severity: "medium"
      package: "com.google.guava:guava"
      version: "28.0"
      fix_available: true
      cve: "CVE-2021-67890"

  expected_scan_results:
    dependency_scan:
      total_vulnerabilities: 0
      critical_count: 0
      high_count: 0
      medium_count: 0
      low_count: 0

    container_scan:
      total_vulnerabilities: 0
      critical_count: 0
      high_count: 0

    gradle_scan:
      total_vulnerabilities: 0
      configurations_scanned: 8

error_handling:
  on_failure:
    - "Generate detailed failure report"
    - "Identify root cause of scan failure"
    - "Attempt retry with reduced scope"
    - "Notify security team"

  on_timeout:
    - "Terminate scan process"
    - "Generate partial results report"
    - "Log timeout incident"

  on_error:
    - "Capture error logs"
    - "Validate environment setup"
    - "Check API connectivity"

reporting:
  success_message: "✅ Security scanning completed successfully - no critical vulnerabilities found"
  failure_message: "❌ Security vulnerabilities detected - review reports immediately"
  warning_message: "⚠️ Security scan completed with warnings - review recommended actions"

  metrics:
    - name: "scan_duration"
      type: "DURATION"
      unit: "seconds"

    - name: "vulnerabilities_found"
      type: "COUNT"
      breakdown_by_severity: true

    - name: "fixable_vulnerabilities"
      type: "COUNT"
      percentage: true

    - name: "scan_coverage"
      type: "PERCENTAGE"
      description: "Percentage of dependencies scanned"

cleanup:
  - "Remove temporary scan artifacts"
  - "Clean up Docker containers"
  - "Archive scan reports"
  - "Update security dashboard"

integration:
  sonar_qube:
    enabled: true
    import_results: true
    quality_gate: "security_gate"

  slack_notifications:
    enabled: true
    channels:
      - "security-alerts"
      - "devops"
    conditions:
      - "critical_vulnerabilities"
      - "scan_failures"

  jira_integration:
    enabled: true
    project_key: "SEC"
    issue_types:
      critical: "Security Vulnerability - Critical"
      high: "Security Vulnerability - High"
      medium: "Security Vulnerability - Medium"